<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
      xmlns:netfx="http://schemas.microsoft.com/wix/NetFxExtension">

  <Product Id="{42633052-FB2B-4758-A22C-6F36EECD8A2F}" UpgradeCode="{9336E341-DF97-4816-9375-1C19ABAC3DAF}" Version="1.0.0.0" Language="1033" Name="Validite Services" Manufacturer="Validite">
    <Package InstallerVersion="300" Compressed="yes" InstallScope="perMachine"/>
    <Media Id="1" Cabinet="myapplication.cab" EmbedCab="yes" />
   
    <!-- Check that Framework 4.5 is Installed -->
    <PropertyRef Id="NETFRAMEWORK45"/>
    <Condition Message="This application requires .NET Framework 4.5. Please install the .NET Framework then run this installer again.">
      <![CDATA[Installed OR (NETFRAMEWORK45)]]>
    </Condition>

    <!-- Add UI to your installer -->
    <UI Id="WixUI_Minimal">
      <TextStyle Id="WixUI_Font_Normal" FaceName="Tahoma" Size="8" />
      <TextStyle Id="WixUI_Font_Bigger" FaceName="Tahoma" Size="12" />
      <TextStyle Id="WixUI_Font_Title" FaceName="Tahoma" Size="9" Bold="yes" />

      <Property Id="DefaultUIFont" Value="WixUI_Font_Normal" />
      <Property Id="WixUI_Mode" Value="Minimal" />

      <DialogRef Id="ErrorDlg" />
      <DialogRef Id="FatalError" />
      <DialogRef Id="FilesInUse" />
      <DialogRef Id="MsiRMFilesInUse" />
      <DialogRef Id="PrepareDlg" />
      <DialogRef Id="ProgressDlg" />
      <DialogRef Id="ResumeDlg" />
      <DialogRef Id="UserExit" />

      <!-- This is the welcome dialog you specified-->
      <DialogRef Id="WelcomeDlg" />

      <!-- Hook the new welcome dialog to the next one in the stack-->
      <Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog" Value="PrepareDlg">1</Publish>

      <Publish Dialog="ExitDialog" Control="Finish" Event="EndDialog" Value="Return" Order="999">1</Publish>

      <Publish Dialog="VerifyReadyDlg" Control="Back" Event="NewDialog" Value="MaintenanceTypeDlg">1</Publish>

      <Publish Dialog="MaintenanceWelcomeDlg" Control="Next" Event="NewDialog" Value="MaintenanceTypeDlg">1</Publish>

      <Publish Dialog="MaintenanceTypeDlg" Control="RepairButton" Event="NewDialog" Value="VerifyReadyDlg">1</Publish>
      <Publish Dialog="MaintenanceTypeDlg" Control="RemoveButton" Event="NewDialog" Value="VerifyReadyDlg">1</Publish>
      <Publish Dialog="MaintenanceTypeDlg" Control="Back" Event="NewDialog" Value="MaintenanceWelcomeDlg">1</Publish>

      <Property Id="ARPNOMODIFY" Value="1" />
    </UI>

    <UIRef Id="WixUI_Common" />

    <!-- Install Procedure to Use PortSetup.exe to Setup PORT in Windows Firewall Inbound Rules -->
    <Binary Id="PortSetup.exe" SourceFile="..\_OtherLive Files\PortSetup.exe" />
  
    <!-- Step 1: Define the directory structure NB Name Holds The New Directory Name -->
    <Directory Id="TARGETDIR" Name="SourceDir">

      <Directory Id="DesktopFolder"  SourceName="Desktop"/>
      <Directory Id="ProgramMenuFolder"  SourceName="ApplicationProgramsFolder"/>
            
      <Directory Id="ProgramFilesFolder" >
        
        <Directory Id="InteractSoftware" Name="Validite">
          
          <Directory Id="APPLICATIONROOTDIRECTORY" Name="Validite Services">
            
            <Component Id="InstalledDirectory" Guid="{1DD98D1E-24E2-4E6C-8DD9-1CE7A293777B}">
              <CreateFolder Directory="APPLICATIONROOTDIRECTORY">
                <Permission User="Everyone" GenericAll="yes" />
              </CreateFolder>
              <RemoveFolder Id='APPLICATIONROOTDIRECTORY' On='uninstall' />
            </Component>

            <Component Id="busBackupRestoreClientDatabase.dll" Guid="{502702CA-53D6-486B-AC16-7F5B96CF66ED}">
              <File Id="busBackupRestoreClientDatabase.dll" Source="..\_TimeAttendanceClientLive Files\Server\GoingLive\busBackupRestoreClientDatabase.dll" KeyPath="yes" Checksum="yes"/>
            </Component>
            
            <Component Id="busClientDataDownload.dll" Guid="{CEEB2716-0ACD-466A-95A0-8D5B52D0151F}">
            <File Id="busClientDataDownload.dll" Source="..\_TimeAttendanceClientLive Files\Server\GoingLive\busClientDataDownload.dll" KeyPath="yes" Checksum="yes"/>
          </Component>

          <Component Id="busClientDataUpload.dll" Guid="{B933EDFC-2C8F-41E4-8B63-1E71B7BDF1B7}">
            <File Id="busClientDataUpload.dll" Source="..\_TimeAttendanceClientLive Files\Server\GoingLive\busClientDataUpload.dll" KeyPath="yes" Checksum="yes"/>
          </Component>

            <Component Id="busClientPayrollLogon.dll" Guid="{35471BA0-DEA4-42EB-85EE-22B605D66C6F}">
            <File Id="busClientPayrollLogon.dll" Source="..\_TimeAttendanceClientLive Files\Server\GoingLive\busClientPayrollLogon.dll" KeyPath="yes" Checksum="yes"/>
          </Component>

          <Component Id="busClientTimeSheetDynamicUpload.dll" Guid="{B1649A5B-4B2D-4A95-871B-7F76E244C6C7}">
            <File Id="busClientTimeSheetDynamicUpload.dll" Source="..\_TimeAttendanceClientLive Files\Server\GoingLive\busClientTimeSheetDynamicUpload.dll" KeyPath="yes" Checksum="yes"/>
          </Component>

           <Component Id="busClock.dll" Guid="{119CE407-C0A5-48A9-9D00-4F6C12303DAC}">
             <File Id="busClock.dll" Source="..\_TimeAttendanceClientLive Files\Server\GoingLive\busClock.dll" KeyPath="yes" Checksum="yes"/>
           </Component>

            <Component Id="busClockInBoundary.dll" Guid="{9A899990-C867-4B78-8C42-31623DA297F1}">
            <File Id="busClockInBoundary.dll" Source="..\_TimeAttendanceClientLive Files\Server\GoingLive\busClockInBoundary.dll" KeyPath="yes" Checksum="yes"/>
          </Component>

          <Component Id="busClockToEmployeeLink.dll" Guid="{F5E70C79-E6B3-4999-9E58-885EE83AFFC7}">
            <File Id="busClockToEmployeeLink.dll" Source="..\_TimeAttendanceClientLive Files\Server\GoingLive\busClockToEmployeeLink.dll" KeyPath="yes" Checksum="yes"/>
          </Component>

            <Component Id="busEmployeeClient.dll" Guid="{CA3CE002-2523-48D9-BF0A-017E5F0BF2E5}">
              <File Id="busEmployeeClient.dll" Source="..\_TimeAttendanceClientLive Files\Server\GoingLive\busEmployeeClient.dll" KeyPath="yes" Checksum="yes"/>
            </Component>

            <Component Id="busEmployeeGroup.dll" Guid="{0B356445-7E4F-434F-8A1D-8753A294DF57}">
              <File Id="busEmployeeGroup.dll" Source="..\_TimeAttendanceClientLive Files\Server\GoingLive\busEmployeeGroup.dll" KeyPath="yes" Checksum="yes"/>
            </Component>

            <Component Id="busEmployeeLinkDevice.dll" Guid="{6F81B5D3-3162-4E9B-822F-2EFCD3F00EBD}">
              <File Id="busEmployeeLinkDevice.dll" Source="..\_TimeAttendanceClientLive Files\Server\GoingLive\busEmployeeLinkDevice.dll" KeyPath="yes" Checksum="yes"/>
            </Component>

            <Component Id="busEmployeeOverride.dll" Guid="{3FC2E961-2778-46F0-85DC-05493846700E}">
              <File Id="busEmployeeOverride.dll" Source="..\_TimeAttendanceClientLive Files\Server\GoingLive\busEmployeeOverride.dll" KeyPath="yes" Checksum="yes"/>
            </Component>

            <Component Id="busRemotBackupSiteName.dll" Guid="{B12B0518-CD2C-4A47-BE73-6943376697A2}">
              <File Id="busRemotBackupSiteName.dll" Source="..\_TimeAttendanceClientLive Files\Server\GoingLive\busRemotBackupSiteName.dll" KeyPath="yes" Checksum="yes"/>
            </Component>

            <Component Id="busTimeAttendanceLogon.dll" Guid="{352110CB-B91F-4C85-9BD4-5AF386A4B366}">
              <File Id="busTimeAttendanceLogon.dll" Source="..\_TimeAttendanceClientLive Files\Server\GoingLive\busTimeAttendanceLogon.dll" KeyPath="yes" Checksum="yes"/>
            </Component>

            <Component Id="busTimeAttendanceMain.dll" Guid="{86B9776A-23BE-48B5-BE77-69B084ACFB94}">
              <File Id="busTimeAttendanceMain.dll" Source="..\_TimeAttendanceClientLive Files\Server\GoingLive\busTimeAttendanceMain.dll" KeyPath="yes" Checksum="yes"/>
            </Component>

            <Component Id="busTimeSheetBatchClient.dll" Guid="{AE9FD695-4A99-421E-B2B2-5EC1573F7436}">
              <File Id="busTimeSheetBatchClient.dll" Source="..\_TimeAttendanceClientLive Files\Server\GoingLive\busTimeSheetBatchClient.dll" KeyPath="yes" Checksum="yes"/>
            </Component>

            <Component Id="busTimeSheetClient.dll" Guid="{2B6D5C61-D749-4F40-ACC5-CB9D36E5CFEF}">
              <File Id="busTimeSheetClient.dll" Source="..\_TimeAttendanceClientLive Files\Server\GoingLive\busTimeSheetClient.dll" KeyPath="yes" Checksum="yes"/>
            </Component>

            <Component Id="busUserClient.dll" Guid="{1E1A2382-C18E-451E-8F04-EC1A30E4EA8D}">
              <File Id="busUserClient.dll" Source="..\_TimeAttendanceClientLive Files\Server\GoingLive\busUserClient.dll" KeyPath="yes" Checksum="yes"/>
            </Component>

            <Component Id="clsDBConnectionObjects.dll" Guid="{6A11AD5F-31E6-4C25-BBA0-F3C608E2166A}">
              <File Id="clsDBConnectionObjects.dll" Source="..\_PayrollLive Files\Server\GoingLive\clsDBConnectionObjects.dll" KeyPath="yes" Checksum="yes"/>
            </Component>

            <Component Id="DPUruNet.dll" Guid="{C62D3555-2958-4396-B38E-D85BDD4B8353}">
              <File Id="DPUruNet.dll" Source="..\_OtherLive Files\DPUruNet.dll" KeyPath="yes" Checksum="yes"/>
            </Component>

            <Component Id="DPCtlUruNet.dll" Guid="{88FA1115-E659-4E83-ADAA-282BABC90E26}">
              <File Id="DPCtlUruNet.dll" Source="..\_OtherLive Files\DPCtlUruNet.dll" KeyPath="yes" Checksum="yes"/>
            </Component>

            <Component Id="FingerPrintClockService.dll" Guid="{F486ECCE-0ACF-4003-97A5-685304490CD5}">
              <File Id="FingerPrintClockService.dll" Source="..\_TimeAttendanceClientLive Files\Server\GoingLive\FingerPrintClockService.dll" KeyPath="yes" Checksum="yes"/>
            </Component>
          
            <Component Id="FingerPrintClockServiceStartStop.dll" Guid="{94090C17-7087-498D-ABE0-014F353B4669}">
              <File Id="FingerPrintClockServiceStartStop.dll" Source="..\_TimeAttendanceClientLive Files\Server\GoingLive\FingerPrintClockServiceStartStop.dll" KeyPath="yes" Checksum="yes"/>
            </Component>
         
            <!-- Windows Service Setup for FingerPrint Clock and TimeAttendance Service -->
            <Component Id="FingerPrintClockTimeAttendanceService.exe" Guid="{FC478357-1E64-4918-9CC6-46279FF3A447}">
              <File Id="FingerPrintClockTimeAttendanceService.exe" Source="..\_OtherLive Files\FingerPrintClockTimeAttendanceService.exe" KeyPath="yes" Checksum="yes"/>
              <ServiceInstall
              Id="ServiceInstaller"
              Type="ownProcess"
              Name="FingerPrintClockTimeAttendanceService"
              DisplayName="FingerPrint Clock and TimeAttendance Service"
              Description="Runs Fingerprint Clock and Time and Attendance (Validite)"
              Start="auto"
              Account="[SERVICEACCOUNT]"
              Password="[SERVICEPASSWORD]"
              ErrorControl="normal"
              Arguments=" /start FingerPrintClockTimeAttendanceWindowsService"  />
              <ServiceControl Id="StartService" Start="install" Stop="both" Remove="uninstall" Name="FingerPrintClockTimeAttendanceService" Wait="yes" />
            </Component>

            <!-- Windows Service Setup for FingerPrint Clock and TimeAttendance Service -->
            <Component Id="FingerPrintClockTimeAttendanceServiceStartStop.exe" Guid="{5D956B77-CAEC-4D87-B21C-3C9521CA1D42}">
              <File Id="FingerPrintClockTimeAttendanceServiceStartStop.exe" Source="..\_OtherLive Files\FingerPrintClockTimeAttendanceServiceStartStop.exe" KeyPath="yes" Checksum="yes"/>
              <ServiceInstall
              Id="ServiceInstaller1"
              Type="ownProcess"
              Name="FingerPrintClockTimeAttendanceServiceStartStop"
              DisplayName="FingerPrint Clock and TimeAttendance Restart Service"
              Description="Restarts Fingerprint Clock and Time and Attendance (Validite)"
              Start="auto"
              Account="[SERVICEACCOUNT]"
              Password="[SERVICEPASSWORD]"
              ErrorControl="normal"
              Arguments=" /start FingerPrintClockTimeAttendanceServiceStartStop"  />
              <ServiceControl Id="StartService1" Start="install" Stop="both" Remove="uninstall" Name="FingerPrintClockTimeAttendanceServiceStartStop" Wait="yes" />
            </Component>

            <Component Id="TestFingerPrintClockTimeAttendanceService.txt" Guid="{06B740E7-637D-4FF8-829F-067F13C7D7DA}">
              <File Id="TestFingerPrintClockTimeAttendanceService.txt" Source="..\_OtherLive Files\TestFingerPrintClockTimeAttendanceService.txt" KeyPath="yes" Checksum="yes"/>
            </Component>
            
          </Directory>
        </Directory>
      </Directory>
    </Directory>
  
    <!-- Step 2: Tell WiX to install the files -->
    <Feature Id="MainApplication" Title="Main Application" Level="1">

      <ComponentRef Id="busBackupRestoreClientDatabase.dll" />

      <ComponentRef Id="busClientDataDownload.dll" />
      <ComponentRef Id="busClientDataUpload.dll" />
      <ComponentRef Id="busClientPayrollLogon.dll" />
      <ComponentRef Id="busClientTimeSheetDynamicUpload.dll" />
      <ComponentRef Id="busClock.dll" />
      <ComponentRef Id="busClockInBoundary.dll" />
      <ComponentRef Id="busClockToEmployeeLink.dll" />

      <ComponentRef Id="busEmployeeClient.dll" />
      <ComponentRef Id="busEmployeeGroup.dll" />
      <ComponentRef Id="busEmployeeLinkDevice.dll" />
      <ComponentRef Id="busEmployeeOverride.dll" />

      <ComponentRef Id="busRemotBackupSiteName.dll" />

      <ComponentRef Id="busTimeAttendanceLogon.dll" />
      <ComponentRef Id="busTimeAttendanceMain.dll" />
      <ComponentRef Id="busTimeSheetBatchClient.dll" />
      <ComponentRef Id="busTimeSheetClient.dll" />

      <ComponentRef Id="busUserClient.dll" />

      <ComponentRef Id="clsDBConnectionObjects.dll" />

      <ComponentRef Id="DPCtlUruNet.dll" />
      <ComponentRef Id="DPUruNet.dll" />

      <ComponentRef Id="FingerPrintClockService.dll" />
      <ComponentRef Id="FingerPrintClockServiceStartStop.dll" />
      <ComponentRef Id="FingerPrintClockTimeAttendanceService.exe" />
      <ComponentRef Id="FingerPrintClockTimeAttendanceServiceStartStop.exe" />
     
      <ComponentRef Id="TestFingerPrintClockTimeAttendanceService.txt" />
      
    </Feature>

    <!-- Grant Read / Write Permission to Created Directory -->
    <Feature Id="FolderPermissions" Title="InstallerDirectoryPermissions" Level="1">
      <ComponentRef Id="InstalledDirectory" />
    
    </Feature>

    <!-- Run PortSetup.exe to Setup PORT in Windows Firewall Inbound Rules -->
    <CustomAction Id="SetupPort" BinaryKey="PortSetup.exe" ExeCommand="" Execute='deferred' Return='asyncNoWait' Impersonate='no'/>
  
    <InstallExecuteSequence>
      <Custom Action="SetupPort" Before="InstallFinalize"><![CDATA[NOT Installed]]></Custom>
     </InstallExecuteSequence>

  </Product>
</Wix>