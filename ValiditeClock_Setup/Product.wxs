<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
      xmlns:netfx="http://schemas.microsoft.com/wix/NetFxExtension">

  <Product Id="{2133B940-2F09-4AE6-969C-E0B8C10650A7}" UpgradeCode="{31ADDC9C-DEE6-413B-8097-4F81D4AD3215}" Version="1.0.0.0" Language="1033" Name="Validite Clock" Manufacturer="Validite">
    <Package InstallerVersion="300" Compressed="yes" InstallScope="perMachine"/>
    <Media Id="1" Cabinet="myapplication.cab" EmbedCab="yes" />
   
    <!-- Add UI to your installer -->
    <UI Id="WixUI_Minimal">
      <TextStyle Id="WixUI_Font_Normal" FaceName="Tahoma" Size="8" />
      <TextStyle Id="WixUI_Font_Bigger" FaceName="Tahoma" Size="12" />
      <TextStyle Id="WixUI_Font_Title" FaceName="Tahoma" Size="9" Bold="yes" />

      <Property Id="DefaultUIFont" Value="WixUI_Font_Normal" />
      <Property Id="WixUI_Mode" Value="Minimal" />

      <DialogRef Id="ErrorDlg" />
      <DialogRef Id="FatalError" />
      <DialogRef Id="FilesInUse" />
      <DialogRef Id="MsiRMFilesInUse" />
      <DialogRef Id="PrepareDlg" />
      <DialogRef Id="ProgressDlg" />
      <DialogRef Id="ResumeDlg" />
      <DialogRef Id="UserExit" />

      <!-- This is the welcome dialog you specified-->
      <DialogRef Id="WelcomeDlg" />

      <!-- Hook the new welcome dialog to the next one in the stack-->
      <Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog" Value="PrepareDlg">1</Publish>

      <Publish Dialog="ExitDialog" Control="Finish" Event="EndDialog" Value="Return" Order="999">1</Publish>

      <Publish Dialog="VerifyReadyDlg" Control="Back" Event="NewDialog" Value="MaintenanceTypeDlg">1</Publish>

      <Publish Dialog="MaintenanceWelcomeDlg" Control="Next" Event="NewDialog" Value="MaintenanceTypeDlg">1</Publish>

      <Publish Dialog="MaintenanceTypeDlg" Control="RepairButton" Event="NewDialog" Value="VerifyReadyDlg">1</Publish>
      <Publish Dialog="MaintenanceTypeDlg" Control="RemoveButton" Event="NewDialog" Value="VerifyReadyDlg">1</Publish>
      <Publish Dialog="MaintenanceTypeDlg" Control="Back" Event="NewDialog" Value="MaintenanceWelcomeDlg">1</Publish>

      <Property Id="ARPNOMODIFY" Value="1" />
    </UI>

    <UIRef Id="WixUI_Common" />

    <!-- Install Procedure to Install C++ Runtime Files -->
    <Binary Id="vcredist_x86.exe" SourceFile="..\_OtherLive Files\vcredist_x86.exe" />
   
    <!-- Step 1: Define the directory structure NB Name Holds The New Directory Name -->
    <Directory Id="TARGETDIR" Name="SourceDir">

      <Directory Id="DesktopFolder"  SourceName="Desktop"/>
      <Directory Id="ProgramMenuFolder"  SourceName="ApplicationProgramsFolder"/>
            
      <Directory Id="ProgramFilesFolder" >
        
        <Directory Id="Validite" Name="Validite">
          
          <Directory Id="APPLICATIONROOTDIRECTORY1" Name="Validite Clock">

            <Component Id="InstalledDirectory1" Guid="{9BBC1E88-1C4E-4153-BF01-6690D00C059D}">
              <CreateFolder Directory="APPLICATIONROOTDIRECTORY1">
                <Permission User="Everyone" GenericAll="yes" />
              </CreateFolder>
              <RemoveFolder Id='APPLICATIONROOTDIRECTORY1' On='uninstall' />
            </Component>

            <Component Id="dpfj.lib" Guid="">
              <File Id="dpfj.lib" Source="..\_OtherLive Files\dpfj.lib" KeyPath="yes" Checksum="yes"/>
            </Component>

            <Component Id="dpfpdd.lib" Guid="">
              <File Id="dpfpdd.lib" Source="..\_OtherLive Files\dpfpdd.lib" KeyPath="yes" Checksum="yes"/>
            </Component>

            <Component Id="IBScanUltimate.dll" Guid="">
              <File Id="IBScanUltimate.dll" Source="..\_OtherLive Files\IBScanUltimate.dll" KeyPath="yes" Checksum="yes"/>
            </Component>

            <Component Id="Clock.exe" Guid="{E47D5FBE-BB55-4A45-88F9-B6908E8EB43A}">
            
              <File Id="Clock.exe" Source="..\_OtherLive Files\Clock.exe" KeyPath="yes" Checksum="yes" >

                <Shortcut Id="DesktopShortcut"
                                Directory="DesktopFolder"
                                Name="Validite Clock"
                                Description="Validite Clock"
                                WorkingDirectory="APPLICATIONROOTDIRECTORY1"
                                Icon="Validite128.ico"
                                Advertise="yes" >
                  <Icon Id="Validite128.ico" SourceFile="..\_OtherLive Files\Validite128.ico" />

                </Shortcut>

                <Shortcut Id="ApplicationShortcut"
                               Directory="ProgramMenuFolder"
                               Name="Validite Clock"
                               Description="Validite Clock"
                               WorkingDirectory="APPLICATIONROOTDIRECTORY1"
                               Icon="Validite64.ico"
                               Advertise="yes" >
                  <Icon Id="Validite64.ico" SourceFile="..\_OtherLive Files\Validite64.ico" />

                </Shortcut>

              </File>
              
            </Component>

            <Component Id="QtCore4.dll" Guid="">
              <File Id="QtCore4.dll" Source="..\_OtherLive Files\QtCore4.dll" KeyPath="yes" Checksum="yes"/>
            </Component>

            <Component Id="QtGui4.dll" Guid="">
              <File Id="QtGui4.dll" Source="..\_OtherLive Files\QtGui4.dll" KeyPath="yes" Checksum="yes"/>
            </Component>

            <Component Id="QtNetwork4.dll" Guid="">
              <File Id="QtNetwork4.dll" Source="..\_OtherLive Files\QtNetwork4.dll" KeyPath="yes" Checksum="yes"/>
            </Component>
            
          </Directory>

        </Directory>
      </Directory>
    </Directory>
  
    <!-- Step 2: Tell WiX to install the files -->
    <Feature Id="MainApplication2" Title="Main Application2" Level="1">
      
      <ComponentRef Id="dpfj.lib" />
      <ComponentRef Id="dpfpdd.lib" />
      <ComponentRef Id="IBScanUltimate.dll" />
      <ComponentRef Id="Clock.exe" />
      <ComponentRef Id="QtCore4.dll" />
      <ComponentRef Id="QtGui4.dll" />
      <ComponentRef Id="QtNetwork4.dll" />
     
    </Feature>

    <!-- Grant Read / Write Permission to Created Directory -->
    <Feature Id="FolderPermissions" Title="InstallerDirectoryPermissions" Level="1">
      <ComponentRef Id="InstalledDirectory1" />
    </Feature>

    <CustomAction Id="vcredist_x86" BinaryKey="vcredist_x86.exe" ExeCommand="" Execute='deferred' Return='asyncNoWait' Impersonate='no'/>

    <InstallExecuteSequence>
      <Custom Action="vcredist_x86" Before="InstallFinalize"><![CDATA[NOT Installed]]></Custom>
    </InstallExecuteSequence>
    
  </Product>
</Wix>